{% extends "sabuzz/base.html" %}
{% block title %}Manage Comments — SA Buzz{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-3xl font-bold">Manage Comments</h1>
    <p class="text-sm text-gray-500">Approve or remove user comments. Only admins may access this page.</p>
  </div>

  {% if comments %}
    <div class="overflow-x-auto bg-white rounded-lg shadow">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Comment</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Post</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>

        <tbody class="bg-white divide-y divide-gray-200">
          {% for c in comments %}
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="text-sm font-medium text-gray-900">{{ c.user.username }}</div>
              <div class="text-xs text-gray-500">{{ c.user.email }}</div>
            </td>

            <td class="px-6 py-4 max-w-xl">
              <div class="text-sm text-gray-700 break-words">{{ c.text }}</div>
            </td>

            <td class="px-6 py-4 whitespace-nowrap">
              <a href="{% url 'post_detail' c.post.id %}" class="text-sm text-blue-600 hover:underline">
                {{ c.post.title }}
              </a>
            </td>

            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {% if c.date_posted %}{{ c.date_posted|date:"M. j, Y, g:i a" }}
              {% elif c.created_at %}{{ c.created_at|date:"M. j, Y, g:i a" }}
              {% else %}—{% endif %}
            </td>

            <td class="px-6 py-4 text-center">
              {% if c.approved %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">Approved</span>
              {% else %}
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800">Pending</span>
              {% endif %}
            </td>

            <td class="px-6 py-4 text-center space-x-2">
              {% if not c.approved %}
              <form method="post" action="{% url 'approve_comment' c.id %}" class="inline">
                {% csrf_token %}
                <button type="submit"
                  class="inline-flex items-center px-3 py-1 rounded-md text-sm font-semibold bg-green-600 text-white hover:bg-green-700">
                  Approve
                </button>
              </form>
              {% endif %}

              <form method="post" action="{% url 'delete_comment' c.id %}" class="inline" onsubmit="return confirm('Delete this comment? This cannot be undone.');">
                {% csrf_token %}
                <button type="submit"
                  class="inline-flex items-center px-3 py-1 rounded-md text-sm font-semibold bg-red-600 text-white hover:bg-red-700">
                  Delete
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="bg-white rounded-lg shadow p-6 text-center">
      <h2 class="text-lg font-semibold text-gray-800 mb-2">No comments yet</h2>
      <p class="text-sm text-gray-500">There are currently no comments to manage.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
